---
import { t, getLocalizedUrl } from '../i18n/index';

// Get current locale and setup i18n
const currentLocale = (Astro.currentLocale || 'en') as 'en' | 'ar';
const isArabic = currentLocale === 'ar';

// Hero slides data with optimized images
const slides = [
  {
    id: 1,
    title: { 
      en: "Premium Car Care Services", 
      ar: "خدمات العناية بالسيارات المتميزة" 
    },
    subtitle: { 
      en: "Experience excellence in automotive care with our professional detailing and maintenance services", 
      ar: "اختبر التميز في العناية بالسيارات مع خدمات التفصيل والصيانة المهنية لدينا" 
    },
    image: "/images/hero.webp",
    imageSources: {
      mobile: "/images/hero.webp",
      tablet: "/images/hero.webp", 
      desktop: "/images/hero.webp"
    },
    ctaLink: "/services"
  },
  {
    id: 2,
    title: { 
      en: "Expert Auto Detailing", 
      ar: "تفصيل السيارات الخبير" 
    },
    subtitle: { 
      en: "Transform your vehicle with our comprehensive detailing packages and paint protection services", 
      ar: "حول سيارتك مع باقات التفصيل الشاملة وخدمات حماية الطلاء لدينا" 
    },
    image: "/images/luxury-detailing.webp",
    imageSources: {
      mobile: "/images/luxury-detailing.webp",
      tablet: "/images/luxury-detailing.webp",
      desktop: "/images/luxury-detailing.webp"
    },
    ctaLink: "/services"
  },
  {
    id: 3,
    title: { 
      en: "Quality You Can Trust", 
      ar: "جودة يمكنك الوثوق بها" 
    },
    subtitle: { 
      en: "Over 15 years of experience delivering exceptional results for luxury and everyday vehicles", 
      ar: "أكثر من 15 عامًا من الخبرة في تقديم نتائج استثنائية للسيارات الفاخرة واليومية" 
    },
    image: "/images/ceramic-coating.webp",
    imageSources: {
      mobile: "/images/ceramic-coating.webp",
      tablet: "/images/ceramic-coating.webp",
      desktop: "/images/ceramic-coating.webp"
    },
    ctaLink: "/about"
  }
];


---

<div class="hero-carousel-wrapper overflow-hidden w-full">
  <div 
    id="optimized-hero-carousel" 
    data-slides={JSON.stringify(slides)}
    data-is-arabic={isArabic}
    data-get-localized-url={getLocalizedUrl.toString()}
  >
    <!-- Fallback content for progressive enhancement -->
    <div class="hero-fallback">
      <div class="relative h-screen w-full overflow-hidden bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
        <img 
          src={slides[0].imageSources.desktop}
          alt={isArabic ? slides[0].title.ar : slides[0].title.en}
          class="absolute inset-0 w-full h-full object-cover opacity-60"
          width="1920"
          height="1080"
          loading="eager"
          fetchpriority="high"
        />
        <div class="absolute inset-0 bg-gradient-to-r from-black/60 via-transparent to-black/40"></div>
        <div class="relative z-10 flex items-center justify-center h-full w-full">
          <div class="text-center text-white w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-bold mb-4 sm:mb-6 animate-fade-in leading-tight">
              {isArabic ? slides[0].title.ar : slides[0].title.en}
            </h1>
            <p class="text-base sm:text-lg md:text-xl lg:text-2xl mb-6 sm:mb-8 opacity-90 animate-fade-in animation-delay-200 max-w-4xl mx-auto leading-relaxed">
              {isArabic ? slides[0].subtitle.ar : slides[0].subtitle.en}
            </p>
            <a 
              href={getLocalizedUrl(slides[0].ctaLink, currentLocale, Astro)}
              class="inline-block px-6 sm:px-8 py-3 sm:py-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-all duration-300 transform hover:scale-105 animate-fade-in animation-delay-400 text-sm sm:text-base"
            >
              {t('common.getStarted')}
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Progressive enhancement - load React component after page load
  import('../components/OptimizedHeroCarousel.tsx').then(({ default: OptimizedHeroCarousel }) => {
    import('react').then(React => {
      import('react-dom/client').then(ReactDOM => {
        const container = document.getElementById('optimized-hero-carousel');
        if (container) {
          const slides = JSON.parse(container.dataset.slides || '[]');
          const isArabic = container.dataset.isArabic === 'true';
          
          // Create getLocalizedUrl function
          const getLocalizedUrl = (url: string) => {
            return isArabic ? `/ar${url}` : `/en${url}`;
          };
          
          const root = ReactDOM.createRoot(container);
          root.render(
            React.createElement(OptimizedHeroCarousel, {
              slides,
              isArabic,
              getLocalizedUrl
            })
          );
        }
      });
    });
  });
</script>

<style>
  .hero-carousel-wrapper {
    position: relative;
    height: 100vh;
    width: 100%;
    max-width: 100vw;
    overflow: hidden;
    margin-top: -64px; /* Offset navbar height on mobile */
    padding-top: 64px; /* Add padding to push content below navbar */
  }
  
  @media (min-width: 768px) {
    .hero-carousel-wrapper {
      margin-top: -80px; /* Offset navbar height on desktop */
      padding-top: 80px; /* Add padding to push content below navbar */
    }
  }
  
  .hero-fallback {
    position: absolute;
    inset: 0;
    z-index: 1;
  }
  
  /* Hide fallback when React component loads */
  .hero-carousel-wrapper:has([data-react-loaded]) .hero-fallback {
    display: none;
  }
</style>
